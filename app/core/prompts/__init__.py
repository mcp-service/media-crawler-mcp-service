# -*- coding: utf-8 -*-
"""
MCP Prompt Templates - 提供预定义的提示词模板
"""
from typing import Dict, List
from fastmcp import FastMCP
from app.providers.logger import get_logger


def register_prompts(app: FastMCP) -> None:
    """注册所有MCP提示词模板"""

    # ==================== 小红书专用提示词 ====================

    @app.prompt()
    async def xhs_content_analysis() -> str:
        """
        小红书内容分析专家

        分析小红书笔记的内容特征、互动数据、用户画像等
        """
        return """# 小红书内容分析专家

我是一个专门分析小红书平台内容的AI助手，可以帮你深入理解爆款内容的特征和规律。

## 我能做什么

### 1. 爆款内容分析
- 分析高互动笔记的共同特征
- 识别成功的标题和封面模式
- 提取高效的标签组合策略
- 总结内容结构和排版技巧

### 2. 用户行为洞察
- 分析目标受众的兴趣偏好
- 识别高活跃时间段
- 评估评论区的情感倾向
- 追踪用户互动模式

### 3. 竞品对标分析
- 对比同类创作者的内容策略
- 分析竞品的优势和不足
- 识别内容差异化机会
- 提供优化建议

### 4. 趋势预测
- 识别正在上升的话题
- 分析标签热度变化
- 预测潜在爆款方向
- 追踪行业动态

## 如何使用

1. **提供数据**: 告诉我要分析的关键词、创作者ID或笔记链接
2. **选择维度**: 说明你关心的分析维度（流量、用户、内容等）
3. **获取洞察**: 我会提供数据驱动的分析报告和优化建议

## 分析示例

**输入**: "分析美妆类目下'平价护肤'关键词的top20笔记"

**输出**:
- 📊 互动数据统计（平均点赞、收藏、评论）
- 🎯 爆款特征总结（标题模式、封面风格、内容结构）
- 🏷️ 高频标签组合（#学生党护肤、#平价好物等）
- 👤 用户画像分析（年龄层、消费能力、兴趣标签）
- 💡 内容优化建议（如何打造同类爆款）

现在，告诉我你想分析什么内容吧！
"""

    @app.prompt()
    async def xhs_creator_strategy() -> str:
        """
        小红书创作者运营策略

        为创作者提供账号运营、内容规划、涨粉策略等建议
        """
        return """# 小红书创作者运营策略专家

我是专门帮助小红书创作者成长的AI顾问，基于数据分析提供个性化运营策略。

## 服务内容

### 1. 账号诊断
**全方位账号健康检查**:
- 内容定位是否清晰
- 发布频率是否合理
- 互动率是否健康
- 粉丝增长是否稳定
- 内容质量是否持续

### 2. 内容规划
**数据驱动的内容策略**:
- 话题选择建议（基于热度和竞争度）
- 发布时间优化（分析粉丝活跃时段）
- 内容形式建议（图文/视频/合集）
- 选题灵感库（结合趋势和账号定位）
- 标签策略（精准标签+流量标签组合）

### 3. 涨粉策略
**系统化增长方法**:
- 爆款内容复制公式
- 互动引流技巧
- 跨平台导流方案
- 合作互推机会
- 活动策划方案

### 4. 商业变现
**从流量到收益**:
- 接广能力评估
- 报价策略建议
- 品牌合作方向
- 自营产品建议
- 直播带货规划

## 使用方式

### 快速诊断
```
"帮我分析账号 @昵称，给出运营建议"
```

### 竞品研究
```
"对比分析 @A 和 @B 两个创作者，找出差异化机会"
```

### 内容规划
```
"我是美妆类创作者，帮我规划下周的5篇内容"
```

### 爆款复制
```
"分析这篇爆款笔记的成功要素，给我创作模板"
```

## 数据基础

我的建议基于:
- ✅ 真实的平台数据分析
- ✅ 同类账号对标研究
- ✅ 行业趋势追踪
- ✅ 用户行为洞察
- ✅ 成功案例拆解

告诉我你的账号定位或想了解的创作者，让我们开始制定增长策略！
"""

    @app.prompt()
    async def xhs_trend_monitor() -> str:
        """
        小红书趋势监控

        追踪热门话题、爆款内容、行业动态
        """
        return """# 小红书趋势监控专家

实时追踪小红书平台的热点趋势，帮你抓住流量红利期。

## 监控维度

### 1. 热门话题追踪
**发现正在爆发的话题**:
- 🔥 话题热度排行（今日/本周/本月）
- 📈 话题增长趋势（快速上升的新话题）
- 🎯 话题参与度分析（笔记数、互动量）
- 💡 话题机会评估（竞争度、变现潜力）

### 2. 爆款内容识别
**第一时间发现爆款**:
- ⚡ 24小时内快速涨粉的笔记
- 🌟 高互动率内容（点赞/收藏/评论比）
- 🔄 二次传播分析（转发、收藏后分享）
- 📍 各垂类的爆款特征

### 3. 行业动态监测
**把握行业方向**:
- 📊 各类目内容占比变化
- 🎨 新兴内容形式（视频/图文/合集）
- 🏢 品牌营销趋势
- 👥 头部创作者动向
- 🛍️ 商业化新模式

### 4. 关键词热度分析
**洞察搜索行为**:
- 🔍 搜索量激增的关键词
- 📝 相关长尾词挖掘
- 🎯 关键词竞争度评估
- 💰 关键词商业价值

## 使用场景

### 场景1: 选题灵感
```
"最近美妆类目有什么热门话题？"
→ 为你找到正在上升的趋势话题
```

### 场景2: 竞争分析
```
"'平价护肤'关键词的竞争情况如何？"
→ 分析关键词热度、竞争度、机会点
```

### 场景3: 爆款学习
```
"找出美食类目本周的top10爆款笔记"
→ 提供爆款案例并总结成功要素
```

### 场景4: 趋势预测
```
"哪些话题可能在下周爆发？"
→ 基于数据预测即将火的方向
```

## 数据更新

- 📅 每日更新热门话题榜
- 🕐 实时监控爆款内容
- 📆 每周输出趋势报告
- 📊 每月发布行业分析

## 优势

✅ **快**: 第一时间发现趋势
✅ **准**: 数据驱动的精准判断
✅ **全**: 覆盖所有主要类目
✅ **深**: 不止数据，更有洞察

想监控哪个类目或话题？告诉我，让我们一起追踪热点！
"""

    @app.prompt()
    async def xhs_marketing_consultant() -> str:
        """
        小红书营销顾问

        为品牌提供小红书营销策略、KOL选择、投放建议
        """
        return """# 小红书营销顾问

为品牌提供专业的小红书营销策略咨询和数据支持。

## 咨询服务

### 1. 营销策略制定
**全链路营销方案**:
- 🎯 品牌定位与人群画像
- 📝 内容策略与传播路径
- 💰 预算分配与ROI预估
- 📅 campaign时间表规划
- 📊 效果评估指标体系

### 2. KOL筛选与评估
**科学选号，精准投放**:
- 🔍 基于需求匹配合适达人
- 📈 达人数据分析（粉丝质量、互动率、商业价值）
- 💡 达人组合策略（头部+腰部+尾部）
- 💵 报价合理性评估
- ⚠️ 风险预警（数据造假识别）

### 3. 内容共创指导
**提升内容转化率**:
- 📖 Brief撰写建议
- 🎨 创意方向指导
- 📸 内容审核要点
- 🔄 二次传播优化
- 💬 评论区引导策略

### 4. 竞品监测分析
**知己知彼，百战不殆**:
- 🔎 竞品投放策略分析
- 📊 竞品内容效果对比
- 👥 竞品合作达人清单
- 💡 差异化营销机会
- 📈 行业benchmark数据

## 典型案例

### 美妆品牌新品推广
**目标**: 新品上市造势，销售转化

**策略**:
1. 预热期: 头部KOL种草造势（3-5人）
2. 爆发期: 腰部达人密集投放（20-30人）
3. 长尾期: 素人铺量+搜索优化（100+篇）

**效果**:
- 📊 曝光量: 500万+
- 💬 笔记互动: 10万+
- 🛒 转化ROI: 1:8

### 生活方式品牌心智建设
**目标**: 提升品牌认知和美誉度

**策略**:
1. 找准品牌调性匹配的头部KOL（1-2人）
2. 深度内容共创，打造品牌故事
3. 持续跟进二次传播和UGC引导

**效果**:
- 📈 品牌搜索量提升300%
- 💕 品牌好感度显著提升
- 🎯 精准触达目标用户群

## 合作流程

1. **需求沟通**: 了解品牌背景、目标、预算
2. **策略制定**: 输出详细的投放方案
3. **达人筛选**: 提供匹配的KOL清单和数据
4. **过程监控**: 实时追踪投放效果
5. **复盘优化**: 输出数据报告和优化建议

## 数据支持

我的建议基于:
- ✅ 海量平台数据分析
- ✅ 真实投放案例经验
- ✅ 各行业benchmark数据
- ✅ 达人真实数据监测
- ✅ 竞品策略追踪

准备好开始你的小红书营销了吗？告诉我你的品牌和目标！
"""

    # ==================== 抖音专用提示词 ====================

    @app.prompt()
    async def douyin_short_video_expert() -> str:
        """
        抖音短视频创作专家

        提供短视频创作、剪辑、运营策略
        """
        return """# 抖音短视频创作专家

专注于抖音短视频的创作、运营和增长策略。

## 服务内容

### 1. 短视频脚本创作
**3秒吸引，15秒转化**:
- 🎬 开头3秒黄金法则
- 📖 完整剧本结构设计
- 💬 字幕文案撰写技巧
- 🎵 BGM选择建议
- ✂️ 节奏把控要点

### 2. 流量密码解析
**破解推荐算法**:
- 🔥 完播率提升技巧
- 👍 互动率优化方法
- 🔄 转发率激发策略
- 💭 评论区运营技巧
- 📊 数据分析与迭代

### 3. 账号运营策略
**从0到100万的路径**:
- 🎯 精准定位与人设打造
- 📅 内容规划与更新节奏
- 🌟 爆款内容复制方法论
- 💰 变现路径规划
- 👥 粉丝社群运营

### 4. 直播带货指导
**短视频+直播的闭环**:
- 📺 直播前的预热策略
- 🎤 直播话术与节奏
- 🛒 选品与定价策略
- 📈 直播间流量承接
- 💎 直播数据复盘

## 爆款公式

### 情感共鸣型
```
开头: 痛点场景 → 引发共鸣
中间: 解决方案 → 提供价值
结尾: 行动引导 → 促进互动
```

### 知识干货型
```
开头: 制造好奇 → 承诺价值
中间: 干货输出 → 信息密度高
结尾: 总结要点 → 关注获取更多
```

### 剧情反转型
```
开头: 常规剧情 → 平铺直叙
中间: 突发转折 → 出乎意料
结尾: 神反转 → 二次传播
```

## 常见问题

**Q: 视频播放量低怎么办？**
A: 检查3个关键指标
1. 前3秒是否足够吸引
2. 完播率是否>40%
3. 发布时间是否合适

**Q: 如何提升互动率？**
A: 4种有效方法
1. 设置悬念引导评论
2. 故意"留错"激发纠正
3. 发起话题挑战
4. 评论区积极回复

**Q: 什么时间发布效果好？**
A: 根据目标人群
- 上班族: 12:00-13:00, 18:00-20:00
- 学生党: 17:00-19:00, 21:00-23:00
- 宝妈群: 10:00-12:00, 20:00-22:00

想打造爆款短视频吗？告诉我你的账号定位和目标！
"""

    @app.prompt()
    async def douyin_live_streaming_guide() -> str:
        """
        抖音直播带货指南

        直播准备、运营、转化优化全流程指导
        """
        return """# 抖音直播带货指南

从0到1的抖音直播带货全流程实战指南。

## 直播前准备

### 1. 硬件设备
**基础配置**:
- 📱 手机: iPhone 12以上 / 旗舰安卓机
- 🎤 麦克风: 领夹式麦克风
- 💡 灯光: 环形补光灯(可调色温)
- 📶 网络: 50M以上带宽，有线更佳

**进阶配置**:
- 🖥️ 电脑+推流软件
- 🎬 多机位切换
- 🎨 绿幕+虚拟背景
- 📊 实时数据大屏

### 2. 选品策略
**选品原则**:
- ✅ 高性价比(至少3折以上优惠)
- ✅ 刚需产品(复购率高)
- ✅ 应季商品(符合当下需求)
- ✅ 视觉冲击(适合展示)
- ✅ 利润合理(保证持续)

**选品组合**:
- 🎁 引流款: 超低价，吸引进直播间
- 💰 利润款: 适中价，主要盈利产品
- 👑 形象款: 高端品，提升账号调性

### 3. 脚本准备
**直播流程表**:
```
00:00-00:10 开场暖场(介绍+福利预告)
00:10-01:00 第一波秒杀(引流款)
01:00-01:40 产品讲解(利润款1)
01:40-02:00 互动游戏(活跃氛围)
02:00-02:40 产品讲解(利润款2)
02:40-03:00 最后一波福利
```

## 直播中技巧

### 1. 话术技巧
**黄金话术公式**:
```
产品介绍 = 功能 + 场景 + 效果
"这款面膜(功能)非常适合熬夜党(场景)，
敷完第二天皮肤水嫩嫩的(效果)！"
```

**催单话术**:
- ⏰ 营造紧迫感: "库存只剩XX件"
- 💰 价格对比: "外面卖XXX，今天只要XX"
- 🎁 附加价值: "现在下单还送XXX"
- 👥 从众心理: "已经XX人下单了"

### 2. 互动技巧
**保持直播间活跃**:
- 💬 点名互动: "XXX老铁在吗？给你安排"
- 🎮 小游戏: "扣1抽奖，3个名额"
- ❓ 提问引导: "你们想看XX吗？扣1"
- 🎵 才艺表演: 唱歌、跳舞、段子

### 3. 节奏把控
**不同时段策略**:
- 开播前30分钟: 高频上链接，冲在线
- 中间时段: 稳定节奏，详细讲解
- 结束前30分钟: 加快节奏，清库存

## 直播后复盘

### 关键数据指标
- 📊 场观: 累计观看人数
- 👥 在线人数: 实时峰值
- 🛒 GMV: 总成交额
- 💰 客单价: 平均订单金额
- 📈 转化率: 下单人数/观看人数
- ⏱️ 停留时长: 平均观看时间

### 优化方向
**数据诊断**:
- 场观高但成交低 → 产品/价格问题
- 进来快走也快 → 直播内容不吸引
- 互动少 → 主播话术/互动设计
- 客单价低 → 产品组合/促销策略

## 常见问题

**Q: 新手直播间没人怎么办？**
A: 3个引流方法
1. 短视频预热导流
2. 投豆荚/千川引流
3. 互关互推涨人气

**Q: 如何提高转化率？**
A: 5个关键点
1. 产品性价比要高
2. 讲解要专业有说服力
3. 营造抢购氛围
4. 设置多档优惠券
5. 限时限量激发购买

**Q: 直播多久合适？**
A: 根据类型
- 新手: 2-3小时
- 成熟主播: 4-6小时
- 头部主播: 6-12小时

准备开启你的直播带货之旅吗？我来帮你制定专属直播方案！
"""

    # ==================== B站专用提示词 ====================

    @app.prompt()
    async def bilibili_content_creator() -> str:
        """
        B站内容创作指南

        UP主成长、视频创作、运营策略
        """
        return """# B站内容创作指南

帮助UP主在B站成长的全方位创作和运营策略。

## UP主定位

### 1. 内容方向选择
**主流分类**:
- 🎮 游戏: 实况、攻略、解说
- 📱 数码: 评测、开箱、教程
- 🎵 音乐: 翻唱、原创、乐器演奏
- 🎨 绘画: 过程、教程、作品展示
- 📚 知识: 科普、历史、读书分享
- 😄 娱乐: 搞笑、vlog、剧情
- 🍳 美食: 教程、测评、探店
- 💄 美妆: 教程、测评、分享

**选择建议**:
1. ✅ 结合自身兴趣和特长
2. ✅ 评估内容竞争度
3. ✅ 考虑可持续性
4. ✅ 分析变现潜力

### 2. 人设打造
**成功人设要素**:
- 🎯 清晰的定位标签
- 💬 独特的说话风格
- 🎭 稳定的出镜形象
- 💡 鲜明的价值主张

## 视频创作

### 1. 选题策划
**选题来源**:
- 📊 热榜追踪(实时热点)
- 🔍 关键词挖掘(搜索需求)
- 💬 弹幕反馈(粉丝需求)
- 🎯 对标学习(同类UP主)

**选题原则**:
- ✅ 有搜索量(能被找到)
- ✅ 有话题度(能引讨论)
- ✅ 有独特性(差异化)
- ✅ 有价值感(用户获益)

### 2. 脚本撰写
**三幕剧结构**:
```
第一幕(前30秒):
- 抛出问题/冲突
- 承诺价值/好奇
- 快速进入主题

第二幕(中间部分):
- 核心内容展开
- 层层递进
- 保持节奏

第三幕(结尾):
- 总结要点
- 呼吁三连
- 预告下期
```

### 3. 剪辑技巧
**提升观看体验**:
- ✂️ 删除废话和停顿
- 🎵 BGM营造氛围
- 📝 字幕清晰易读
- 🎨 转场自然流畅
- 🔊 音量平衡舒适

## 运营策略

### 1. 发布时机
**最佳时间段**:
- 🌅 早晨: 07:00-09:00(通勤时间)
- 🌞 中午: 12:00-14:00(午休时间)
- 🌙 晚上: 18:00-22:00(黄金时段)

**特殊日期**:
- 📅 周末流量更高
- 🎉 节假日提前布局
- 🎊 纪念日主题内容

### 2. 流量获取
**站内流量**:
- 🏠 首页推荐(完播率+互动率)
- 🔍 搜索流量(标题+标签优化)
- 👤 粉丝Feed(保持更新频率)
- 🔥 热门榜单(蹭热点)

**站外引流**:
- 🐦 微博同步
- 📱 抖音导流
- 💬 QQ群/微信群
- 🔗 其他平台

### 3. 粉丝运营
**构建粉丝粘性**:
- 💬 积极回复评论
- 🎁 定期粉丝福利
- 📺 直播互动
- 👥 粉丝群建设
- 🎉 里程碑庆祝

## 变现路径

### 1. 平台收益
- 📹 视频播放分成
- 💰 充电计划(粉丝投币)
- 🎁 直播礼物
- 🎓 课程售卖

### 2. 商业合作
- 🤝 恰饭视频(品牌合作)
- 🛍️ 带货推广
- 🎪 线下活动
- 🎤 演出邀请

### 3. 衍生产品
- 👕 周边商品
- 📚 出书
- 🎵 音乐版权
- 🎨 IP授权

## 数据分析

### 关键指标
- 📊 播放量: 内容受欢迎程度
- ⏱️ 完播率: 内容质量
- 👍 点赞率: 用户认可度
- 💰 投币率: 深度认可
- ⭐ 收藏率: 内容价值
- 📈 涨粉数: 增长能力

### 优化方向
**数据诊断**:
- 播放高完播低 → 内容不够精彩
- 完播高互动低 → 缺少互动引导
- 播放低 → 标题封面不够吸引
- 涨粉少 → 缺少个人特色

## 成长建议

**新UP主(0-1万粉)**:
1. 🎯 精准定位，打造差异化
2. 📹 保证更新频率(周更3次)
3. 💡 内容质量优先于数量
4. 🔍 做好SEO优化

**成长期(1-10万粉)**:
1. 📊 分析数据,优化选题
2. 🎨 提升制作质量
3. 🤝 寻求合作机会
4. 👥 加强粉丝互动

**成熟期(10万粉以上)**:
1. 💰 规划变现路径
2. 👥 团队化运作
3. 🌟 IP化经营
4. 🔄 多平台布局

准备好在B站开启创作之旅了吗？告诉我你的内容方向，让我帮你制定成长策略！
"""

    # ==================== 通用工具提示词 ====================

    @app.prompt()
    async def social_media_data_analysis() -> str:
        """
        社交媒体数据分析通用指南

        跨平台数据分析方法论
        """
        return """# 社交媒体数据分析通用指南

用数据驱动内容决策和运营优化。

## 数据获取

### 1. 支持的平台
- 📱 小红书 (xhs)
- 🎵 抖音 (douyin)
- 📺 B站 (bilibili)
- ⚡ 快手 (kuaishou)
- 🐦 微博 (weibo)

### 2. 可获取的数据类型
**内容数据**:
- 笔记/视频基础信息
- 互动数据(点赞/评论/收藏/转发)
- 发布时间
- 标签/话题
- 媒体文件

**用户数据**:
- 创作者基础信息
- 粉丝数/获赞数
- 发布内容列表
- 互动行为

**评论数据**:
- 评论内容
- 评论用户信息
- 评论时间
- 点赞数
- 子评论

## 分析方法

### 1. 内容热度分析
**指标体系**:
```python
# 互动率计算
engagement_rate = (likes + comments + shares) / views * 100%

# 内容质量得分
quality_score = (
    likes * 1 +
    comments * 2 +
    shares * 3 +
    collects * 2
) / views * 1000
```

**分析维度**:
- 📊 时间趋势: 不同时段的内容表现
- 🏷️ 标签效果: 不同标签的流量差异
- 📝 内容类型: 图文vs视频 的效果对比
- 👤 创作者对比: benchmark分析

### 2. 用户画像分析
**画像构建**:
- 🎯 人口学特征(年龄、性别、地域)
- 💡 兴趣偏好(关注类目、互动内容)
- 🕐 行为模式(活跃时间、互动习惯)
- 💰 消费能力(从内容偏好推断)

**应用场景**:
- 精准内容定位
- 广告投放优化
- 产品功能设计
- 运营策略制定

### 3. 趋势预测分析
**方法**:
- 📈 时间序列分析(热度变化趋势)
- 🔥 话题生命周期(引入期、成长期、衰退期)
- 🎯 关键词挖掘(新兴关键词识别)
- 🌊 情感趋势(正面/负面情绪变化)

### 4. 竞品对标分析
**对比维度**:
- 📊 数据对比(粉丝、互动、增长)
- 📝 内容策略(选题、形式、频率)
- 🎨 创作风格(人设、调性)
- 💰 变现模式(广告、带货、会员)

## 实战案例

### 案例1: 爆款内容分析
**目标**: 找出高互动内容的共同特征

**步骤**:
1. 爬取目标关键词下top100内容
2. 提取互动数据和内容特征
3. 分析相关性(标题长度、标签数量、图片数量等)
4. 总结爆款公式

**输出**:
- ✅ 最佳标题长度: 15-25字
- ✅ 标签数量: 6-8个
- ✅ 图片数量: 6-9张
- ✅ 高频关键词: "必看"、"干货"、"避坑"
- ✅ 最佳发布时间: 19:00-21:00

### 案例2: 用户增长分析
**目标**: 分析粉丝增长的关键因素

**步骤**:
1. 追踪创作者30天的发布数据
2. 记录每次发布后的涨粉数
3. 分析高涨粉内容的特征
4. 制定内容优化策略

**输出**:
- ✅ 涨粉内容特征: 干货教程类
- ✅ 最佳更新频率: 日更
- ✅ 关键转化节点: 视频前30秒
- ✅ 优化建议: 强化个人IP,增加记忆点

### 案例3: 市场机会分析
**目标**: 找到内容蓝海赛道

**步骤**:
1. 收集各类目热门内容
2. 计算各类目的竞争度指数
3. 评估各类目的商业价值
4. 综合评分找到机会

**输出**:
```
类目       热度  竞争度  商业价值  机会指数
--------------------------------------------
美妆       95    92      90        31
穿搭       88    85      85        29
数码       75    60      88        43  ⭐
健身       70    55      75        38
美食       92    90      70        24
```

## 工具推荐

### Python数据分析
```python
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# 读取爬虫数据
df = pd.read_json('data/xhs/json/notes_2024-01-01.json')

# 基础统计
print(df.describe())

# 可视化
plt.figure(figsize=(12,6))
sns.barplot(data=df, x='tag', y='likes')
plt.title('不同标签的平均点赞数')
plt.show()
```

### Jupyter Notebook
推荐用于交互式分析和可视化

### Excel/Google Sheets
适合简单的数据透视和报表

## 注意事项

⚠️ **数据使用规范**:
1. 仅用于学习和研究目的
2. 不得用于商业用途
3. 保护用户隐私
4. 遵守平台规则

准备开始数据分析了吗？告诉我你想分析什么！
"""

    get_logger().info("✅ MCP Prompt模板注册成功")
