{% extends "layout.html" %}

{% block title %}登录中心 - MCP Tools{% endblock %}

{% block content %}
<section class="login-page">
    <div class="login-headline">
        <span class="login-pill">登录控制</span>
        <h2 class="login-title page-title">
            多平台登录中心
            <span id="page-status" class="page-status"></span>
        </h2>
        <p class="login-description">
            支持扫码、Cookie、手机号等方式触发登录，并通过同一面板查看状态、刷新二维码或重新发起流程。
        </p>
        <div class="login-endpoints">
            <span class="endpoint-chip">GET /api/login/platforms</span>
            <span class="endpoint-chip">POST /api/login/start</span>
            <span class="endpoint-chip">GET /api/login/session/&lt;id&gt;</span>
            <span class="endpoint-chip">GET /api/login/status/&lt;platform&gt;</span>
            <span class="endpoint-chip">POST /api/login/logout/&lt;platform&gt;</span>
        </div>
    </div>
    <div class="login-grid">
        <article class="card login-card">
            <div class="card-header">
                <div class="card-eyebrow">会话发起</div>
                <h2>启动新的登录流程</h2>
                <p>任选登录方式立即生成二维码或触发 Cookie、手机号登录，全程自动跟踪状态。</p>
            </div>
            <div class="card-body">
                <form id="login-form">
                    <div class="login-field-grid">
                        <div class="form-group">
                            <label for="platform" class="form-label">选择平台</label>
                            <select name="platform" id="platform" class="form-control" required>
                                <option value="">请选择平台</option>
                            </select>
                            <small class="form-text" id="platform-tip">正在加载可用平台...</small>
                        </div>
                        <div class="form-group">
                            <label for="login_type" class="form-label">登录方式</label>
                            <select name="login_type" id="login_type" class="form-control" onchange="toggleLoginFields()">
                                <option value="qrcode">二维码扫码登录</option>
                                <option value="cookie">Cookie 登录</option>
                                <option value="phone">手机号登录</option>
                            </select>
                        </div>
                    </div>
                    <div id="phone-field" class="form-group d-none">
                        <label for="phone" class="form-label">手机号</label>
                        <input type="tel" name="phone" id="phone" class="form-control" placeholder="请输入用于登录的手机号">
                    </div>
                    <div id="cookie-field" class="form-group d-none">
                        <label for="cookie" class="form-label">Cookie</label>
                        <textarea name="cookie" id="cookie" class="form-control" rows="4" placeholder="从浏览器开发者工具拷贝完整 Cookie 后粘贴到此处"></textarea>
                    </div>
                    <div class="login-action-row">
                        <button type="submit" id="login-submit-btn" class="btn btn-primary">开始登录</button>
                        <button type="button" class="btn btn-secondary" onclick="refreshLoginStatus()">刷新状态</button>
                        <button type="button" class="btn btn-outline-secondary d-none" id="refresh-qr-btn">刷新二维码</button>
                    </div>
                </form>
                <div class="login-status-stack">
                    <div id="login-status" class="status status-info">选择平台并点击 "开始登录"，进度将实时呈现。</div>
                    <div id="qr-code-container" class="qr-display d-none">
                        <div id="qr-countdown" class="qr-countdown"></div>
                        <div id="qr-image-wrapper"></div>
                    </div>
                </div>
            </div>
        </article>
        <aside class="login-side">
            <div class="card login-summary">
                <div class="card-header">
                    <div class="card-eyebrow">操作说明</div>
                    <h3>流程要点</h3>
                </div>
                <div class="card-body">
                    <p>登录状态和二维码展示区与主表单联动，方便快速校验状态。</p>
                    <ul>
                        <li>登录过程中会维持轮询，成功/失败都会即时回传。</li>
                        <li>若二维码过期，可使用“刷新二维码”按钮重新生成。</li>
                        <li>右侧平台列表展示历史会话，可直接跳转到对应平台快速登录。</li>
                    </ul>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-eyebrow">在线会话</div>
                    <h3>平台登录状态</h3>
                </div>
                <div class="card-body">
                    <div class="platform-groups" id="platform-sessions">
                        <div class="platform-empty">正在加载平台状态...</div>
                    </div>
                </div>
            </div>
        </aside>
    </div>
</section>
{% endblock %}

{% block scripts %}{% endblock %}
