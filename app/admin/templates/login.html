{% extends "layout.html" %}

{% block title %}登录管理 - MCP Tools{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>🔐 平台登录管理</h2>
    </div>
    <div class="card-body">
        <!-- 登录表单 -->
        <form id="login-form" class="mb-4">
            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <label for="platform" class="form-label">选择平台</label>
                        <select name="platform" id="platform" class="form-control" required>
                            <option value="">请选择平台</option>
                        </select>
                        <small class="form-text text-muted" id="platform-tip">正在加载可用平台...</small>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="login_type" class="form-label">登录方式</label>
                        <select name="login_type" id="login_type" class="form-control" onchange="toggleLoginFields()">
                            <option value="qrcode">二维码扫码</option>
                            <option value="cookie">Cookie登录</option>
                            <option value="phone">手机号登录</option>
                        </select>
                    </div>
                </div>
            </div>

            <div id="phone-field" class="form-group d-none">
                <label for="phone" class="form-label">手机号</label>
                <input type="tel" name="phone" id="phone" class="form-control" placeholder="请输入手机号">
            </div>

            <div id="cookie-field" class="form-group d-none">
                <label for="cookie" class="form-label">Cookie</label>
                <textarea name="cookie" id="cookie" class="form-control" rows="4" placeholder="从浏览器开发者工具获取Cookie，粘贴到此处..."></textarea>
            </div>

            <div class="form-group">
                <button type="submit" id="login-submit-btn" class="btn btn-primary">开始登录</button>
                <button type="button" class="btn btn-secondary" onclick="refreshLoginStatus()">刷新状态</button>
                <button type="button" class="btn btn-outline-secondary d-none" id="refresh-qr-btn">刷新二维码</button>
            </div>
        </form>

        <!-- 登录状态显示 -->
        <div id="login-status" class="mb-3 text-center status"></div>

        <!-- 二维码容器 -->
        <div id="qr-code-container" class="d-none">
            <div id="qr-countdown" class="text-center text-muted small mb-2"></div>
        </div>
    </div>
</div>

<!-- 平台登录状态 -->
<div class="card">
    <div class="card-header">
        <h2>📱 平台登录状态</h2>
    </div>
    <div class="card-body">
        <div class="platform-list" id="platform-sessions">
            <div class="text-center">
                <p>正在加载平台状态...</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}{% endblock %}
